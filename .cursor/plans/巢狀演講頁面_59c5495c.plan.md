---
name: 巢狀演講頁面
overview: 擴充資料表欄位、API 與 SSR，支援巢狀演講列表與細節頁。
todos:
  - id: schema
    content: 更新 schema 與種子資料
    status: pending
  - id: api
    content: 擴充 speech API 支援巢狀
    status: pending
    dependencies:
      - schema
  - id: views
    content: 新增巢狀 SSR 路由與檢視
    status: pending
    dependencies:
      - schema
      - api
  - id: verify
    content: 以範例資料檢查路由與渲染
    status: pending
    dependencies:
      - views
---

# 巢狀演講頁面實作計劃

- 調整資料庫 schema：在 [`sayit-backend/sql/init-speech_index.sql`](/Users/bestian/Documents/GitHub/sayit-backend/sql/init-speech_index.sql) 加入 `isNested`, `nest_filenames`, `nest_display_names`；在 [`sayit-backend/sql/init-speech_content.sql`](/Users/bestian/Documents/GitHub/sayit-backend/sql/init-speech_content.sql) 加入 `nest_filename`, `nest_display_name`，並同步更新相關種子檔（如 [`sql/speech/1999年全國司法改革會議.sql`](/Users/bestian/Documents/GitHub/sayit-backend/sql/speech/1999年全國司法改革會議.sql)）。
- API 支援巢狀：更新 [`src/api/speech_index.ts`](/Users/bestian/Documents/GitHub/sayit-hono/src/api/speech_index.ts) 返回新欄位（含陣列化 nest 資料），並在 [`src/api/speech.ts`](/Users/bestian/Documents/GitHub/sayit-hono/src/api/speech.ts) 支援路由 `/api/speech/{filename}/{nest_filename}` 以 `filename + nest_filename` 過濾段落。
- SSR 與檢視：在 [`src/index.ts`](/Users/bestian/Documents/GitHub/sayit-hono/src/index.ts) 判斷 `isNested` 時改用巢狀列表檢視，並新增巢狀細節路由 `/:filename/:nest_filename`。新增檢視 [`src/views/NestedSpeechView.vue`](/Users/bestian/Documents/GitHub/sayit-hono/src/views/NestedSpeechView.vue)（巢狀列表）與 [`src/views/SingleNestedSpeechView.vue`](/Users/bestian/Documents/GitHub/sayit-hono/src/views/SingleNestedSpeechView.vue)（巢狀內容），確保 `.generated` 匯入與樣式串接。
- 驗證：以範例檔（1999 年司法改革）手動比對巢狀列表與細節頁生成的資料，確認路由與 API 回傳均符合預期。
```mermaid
flowchart TD
  user[User]
  listReq[/:filename (isNested=1)]
  nestedList[Render NestedSpeechView]
  detailReq[/:filename/:nest]
  detailApi[/api/speech/:filename/:nest]
  nestedDetail[Render SingleNestedSpeechView]

  user --> listReq --> nestedList
  user --> detailReq --> detailApi --> nestedDetail


```